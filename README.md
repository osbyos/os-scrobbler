<h1 align="center">os-scrobbler</h1>

<p align="center">os-scrobbler is a scrobble.log scrobbler -- used in tandem with the files that rockbox generates!</p>

<p align="center">Built based on <a href="https://github.com/Ximik/Laspyt">Lastpyt</a> â€” UI to authorize with Last.fm, upload your log file, preview tracks, adjust timestamps for timezone differences, and submit them to your Last.fm profile.</p>

<h2 align="center">Features</h2>

<ul>
    <li><strong>Last.fm Authentication:</strong> Securely authorize your application with your Last.fm account; no information stored on my end!</li>
    <li><strong>.scrobbler.log Parsing:</strong> Upload and parse standard .scrobbler.log files generated by Rockbox.</li>
    <li><strong>Track Preview:</strong> View a list of tracks extracted from your log file, including artist, title, and original timestamp.</li>
    <li><strong>Timezone Adjustment:</strong> Easily adjust timestamps by hours to correct for timezone discrepancies, ensuring accurate scrobble times.</li>
    <li><strong>Batch Scrobbling:</strong> Submit multiple tracks from your log file in one go.</li>
</ul>

<h2 align="center">Technologies Used</h2>

<ul>
    <li><strong>Backend:</strong> <a href="https://flask.palletsprojects.com/">Flask</a> (Python web framework)</li>
    <li><strong>HTTP Requests:</strong> <a href="https://requests.readthedocs.io/en/latest/">Requests</a> (Python library)</li>
    <li><strong>WSGI Server:</strong> <a href="https://gunicorn.org/">Gunicorn</a> (for production deployment)</li>
    <li><strong>Frontend:</strong> HTML, CSS, JavaScript</li>
    <li><strong>Hosting:</strong> Designed for deployment on <a href="https://render.com/">Render</a></li>
</ul>

<h2 align="center">Setup (Local Development)</h2>

Follow these steps to get `os-scrobbler` running on your local machine.

<h3>Prerequisites</h3>

<ul>
    <li>Python 3.8+</li>
    <li>`pip` (Python package installer)</li>
    <li>`venv` (Python's built-in virtual environment module)</li>
    <li>Git</li>
</ul>

<h3>1. Clone the Repository</h3>

First, clone your project repository to your local machine:

<pre><code>git clone https://github.com/YOUR_USERNAME/os-scrobbler.git
cd os-scrobbler
</code></pre>

(Replace `YOUR_USERNAME` with your actual GitHub username)

<h3>2. Create and Activate a Virtual Environment</h3>

It's highly recommended to use a virtual environment to manage your project's dependencies:

<pre><code>python3 -m venv venv
# On macOS/Linux:
source venv/bin/activate
# On Windows:
# .\venv\Scripts\activate
</code></pre>

<h3>3. Install Dependencies</h3>

With your virtual environment activated, install the required Python packages:

<pre><code>pip install -r requirements.txt
</code></pre>

<h3>4. Last.fm API Key Setup (Local)</h3>

You need to register an application with Last.fm to get your API Key and Secret.

<ol>
    <li>Go to the <a href="https://www.last.fm/api/account">Last.fm API Account</a> page.</li>
    <li>Click "Get an API account".</li>
    <li>Fill out the application details:
        <ul>
            <li><strong>Contact email:</strong> Your email address.</li>
            <li><strong>Application name:</strong> <code>os-scrobbler</code> (or a unique name you prefer).</li>
            <li><strong>Application description:</strong> <code>A web application to parse .scrobbler.log files and upload old scrobbles to Last.fm, with timezone adjustment.</code></li>
            <li><strong>Callback URL:</strong> <strong><code>http://localhost:5000/callback</code></strong> (Crucial for local testing!)</li>
            <li><strong>Application homepage:</strong> <code>http://localhost:5000</code></li>
        </ul>
    </li>
    <li>Complete the reCAPTCHA and submit.</li>
    <li>You will be provided with your <strong>API Key</strong> and <strong>API Secret</strong>. Keep these safe!</li>
</ol>

<h3>5. Set Environment Variables (Local)</h3>

For local development, you can set these directly in your terminal before running the app. For a more permanent local setup, consider using a `.env` file and a library like `python-dotenv` (though not included in the current `requirements.txt`).

<pre><code>export LASTFM_API_KEY="YOUR_LASTFM_API_KEY"
export LASTFM_API_SECRET="YOUR_LASTFM_API_SECRET"
export FLASK_SECRET_KEY="a_very_long_and_random_string_for_local_sessions"
export LASTFM_CALLBACK_URL="http://localhost:5000/callback"
</code></pre>

(Replace placeholders with your actual keys and a random string for `FLASK_SECRET_KEY`.)

<h3>6. Run the Application Locally</h3>

<pre><code>python app.py
</code></pre>

The application should now be running at `http://localhost:5000`.

<h2 align="center">Deployment (Render)</h2>

This application is configured for easy deployment on <a href="https://render.com/">Render.com</a>, a cloud platform for hosting web services.

<h3>1. Prepare for Git</h3>

Ensure your project has the following files in its root directory:

<ul>
    <li><code>app.py</code>: Your main Flask application file.</li>
    <li><code>requirements.txt</code>: Lists all Python dependencies (e.g., <code>Flask</code>, <code>requests</code>, <code>gunicorn</code>).</li>
    <li><code>Procfile</code>: Tells Render how to start your web server (<code>web: gunicorn app:app</code>).</li>
</ul>

Make sure all your latest code changes are committed and pushed to your GitHub (or GitLab/Bitbucket) repository.

<pre><code>git add .
git commit -m "Prepare app for Render deployment"
git push origin main
</code></pre>

<h3>2. Create Web Service on Render</h3>

<ol>
    <li>Go to <a href="https://render.com/">Render.com</a> and log in.</li>
    <li>Click <strong>"New"</strong> -> <strong>"Web Service"</strong>.</li>
    <li>Connect your Git repository (GitHub, GitLab, or Bitbucket) and select your <code>os-scrobbler</code> repository.</li>
    <li>Configure the service settings:
        <ul>
            <li><strong>Name:</strong> <code>os-scrobbler</code> (or a unique name)</li>
            <li><strong>Region:</strong> Choose a suitable region.</li>
            <li><strong>Branch:</strong> <code>main</code> (or your primary branch)</li>
            <li><strong>Root Directory:</strong> Leave blank (if <code>app.py</code> is in the repo root).</li>
            <li><strong>Runtime:</strong> <code>Python 3</code></li>
            <li><strong>Build Command:</strong> <code>pip install -r requirements.txt</code></li>
            <li><strong>Start Command:</strong> <code>gunicorn app:app</code></li>
            <li><strong>Instance Type:</strong> "Free" is usually fine for testing.</li>
        </ul>
    </li>
</ol>

<h3>3. Set Environment Variables on Render (CRITICAL!)</h3>

This is where you securely provide your API keys to Render.

<ul>
    <li>In the Render service settings, go to the <strong>"Environment Variables"</strong> section.</li>
    <li>Add the following:
        <ul>
            <li><strong>Key:</strong> <code>FLASK_SECRET_KEY</code><br><strong>Value:</strong> A <strong>new, very strong, and random string</strong>. Generate one using <code>python3 -c "import os; print(os.urandom(24).hex())"</code> and paste it here.</li>
            <li><strong>Key:</strong> <code>LASTFM_API_KEY</code><br><strong>Value:</strong> Your actual Last.fm API Key.</li>
            <li><strong>Key:</strong> <code>LASTFM_API_SECRET</code><br><strong>Value:</strong> Your actual Last.fm API Secret.</li>
            <li><strong>Key:</strong> <code>LASTFM_CALLBACK_URL</code><br><strong>Value:</strong> <strong><code>https://YOUR_RENDER_APP_URL/callback</code></strong> (e.g., <code>https://os-scrobbler.onrender.com/callback</code>). You'll get your exact Render URL after the first deployment.</li>
        </ul>
    </li>
</ul>

<h3>4. Deploy and Update Last.fm Callback URL</h3>

<ol>
    <li>Click <strong>"Create Web Service"</strong> on Render.</li>
    <li>Monitor the build logs. Once deployed, Render will provide you with your public URL (e.g., <code>https://os-scrobbler.onrender.com</code>).</li>
    <li><strong>Immediately go back to your Last.fm API application settings.</strong></li>
    <li><strong>Update the "Callback URL" field to your Render app's URL:</strong> <code>https://YOUR_RENDER_APP_URL/callback</code></li>
    <li><strong>Update the "Application homepage" field to:</strong> <code>https://YOUR_RENDER_APP_URL</code></li>
    <li><strong>Save</strong> the changes on the Last.fm site.</li>
</ol>

Your application should now be fully functional on your Render URL!

<h2 align="center">Usage</h2>

<ol>
    <li><strong>Go to your application's URL</strong> (local or deployed).</li>
    <li>Click the <strong>"authorize with last.fm"</strong> button.</li>
    <li>You'll be redirected to Last.fm to grant permissions.</li>
    <li>After authorization, you'll be redirected back to your app's scrobbler page.</li>
    <li><strong>Upload your `.scrobbler.log` file.</strong></li>
    <li>Review the parsed tracks. If needed, adjust the "timezone offset (hours)" to correct timestamps.</li>
    <li>Click <strong>"upload adjusted scrobbles"</strong> to submit them to Last.fm.</li>
    <li>View the results of the scrobble submission.</li>
</ol>

<h2 align="center">License</h2>

This project is open-source and available under the MIT License.
